import{_ as E}from"./CRWhLXmG.js";import{q as O,e as b,i as Q,_ as R,U as B,f as D,E as P,o as y,c as g,a as r,n as k,g as h,t as S,b as N,w as q,d as C,h as U,j as A}from"./BP8Zqz1I.js";import{a as M,u as I}from"./9Frihcan.js";const x="ceramic_cart_v1";function V(){const a=M("cart-items",()=>[]),c=M("cart-initialized",()=>!1),i=I(),u=Q(),f=String(u.public.apiBase||"").replace(/\/$/,"");if(!c.value)try{const t=localStorage.getItem(x);if(t){const s=JSON.parse(t);Array.isArray(s)&&(a.value=s.map(e=>({id:Number(e?.id),name:String(e?.name||""),price:Number(e?.price||0),qty:Math.max(1,Number(e?.qty||1)),image:e?.image?String(e.image):void 0,slug:e?.slug?String(e.slug):void 0})).filter(e=>Number.isFinite(e.id)&&e.id>0&&e.name))}}catch{}finally{c.value=!0}O(a,t=>{try{localStorage.setItem(x,JSON.stringify(t))}catch{}},{deep:!0});const w=b(()=>a.value.reduce((t,s)=>t+(s.qty||0),0)),l=b(()=>a.value.reduce((t,s)=>t+(s.price||0)*(s.qty||0),0)),d=t=>a.value.find(s=>s.id===t)?.qty||0,m=async(t,s)=>{if(!i.isAuthenticated.value||!i.user.value?.id)return!1;try{const e=new URLSearchParams({id:"0",userId:String(i.user.value.id),productId:String(t),quantity:String(Math.max(0,s))}),o=`${f}/user/cart?${e.toString()}`;return await $fetch(o,{method:"POST",headers:{accept:"*/*"}}),!0}catch(e){return console.warn("Failed to sync cart item with backend:",e),!1}},v=async(t,s=1)=>{const e=Math.max(1,Number(s||1)),o=a.value.find(p=>p.id===t.id);if(o){const p=o.qty+e;return await m(t.id,p)?(o.qty=p,!0):!1}return await m(t.id,e)?(a.value.push({...t,qty:e}),!0):!1},n=async(t,s)=>{const e=Math.max(0,Number(s||0)),o=a.value.findIndex(p=>p.id===t);return o===-1||!await m(t,e)?!1:e<=0?(a.value.splice(o,1),!0):(a.value[o].qty=e,!0)};return{items:a,totalQty:w,subtotal:l,getQty:d,addItem:v,setQty:n,inc:async(t,s=1)=>{const e=d(t)+Math.max(1,Number(s||1));return await n(t,e)},dec:async(t,s=1)=>{const e=d(t)-Math.max(1,Number(s||1));return await n(t,e)},clear:async()=>{if(i.isAuthenticated.value&&i.user.value?.id){const t=a.value.map(s=>m(s.id,0));await Promise.all(t).catch(()=>{})}a.value=[]}}}const $={key:0,class:"dropdown-content"},T={class:"user-info"},z={class:"user-name"},F={class:"user-phone"},G={key:1,class:"dropdown-content"},J={class:"login-prompt"},j={__name:"AccountDropdown",setup(a){const c=I(),i=B(),u=A(!1),f=A(null),w=()=>{u.value=!u.value},l=()=>{u.value=!1},d=v=>{f.value&&!f.value.contains(v.target)&&l()},m=async()=>{await V().clear(),c.logout(),l(),i.push("/collections")};return D(()=>{document.addEventListener("click",d)}),P(()=>{document.removeEventListener("click",d)}),(v,n)=>{const _=E;return y(),g("div",{class:"account-dropdown-wrapper",ref_key:"dropdownRef",ref:f},[r("button",{class:"account-btn",type:"button","aria-label":"Account menu",onClick:k(w,["stop"])}," ðŸ‘¤ "),u.value?(y(),g("div",{key:0,class:"account-dropdown",onClick:n[0]||(n[0]=k(()=>{},["stop"]))},[h(c).isAuthenticated.value?(y(),g("div",$,[r("div",T,[r("div",z,S(h(c).user.value?.username||"User"),1),r("div",F,S(h(c).user.value?.phoneNumber||""),1)]),n[2]||(n[2]=r("div",{class:"dropdown-divider"},null,-1)),N(_,{to:"/orders",class:"dropdown-item",onClick:l},{default:q(()=>[...n[1]||(n[1]=[C(" ðŸ“¦ My Orders ",-1)])]),_:1}),r("button",{class:"dropdown-item logout-btn",type:"button",onClick:m}," ðŸšª Logout ")])):(y(),g("div",G,[r("div",J,[n[4]||(n[4]=r("p",{class:"login-message"},"Login to view account",-1)),N(_,{to:"/login",class:"login-link",onClick:l},{default:q(()=>[...n[3]||(n[3]=[C(" Go to Login ",-1)])]),_:1})])]))])):U("",!0)],512)}}},tt=R(j,[["__scopeId","data-v-26af7b34"]]);export{tt as _,V as u};
