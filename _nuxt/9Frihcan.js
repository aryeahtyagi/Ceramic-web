import{B as h,N as d,V as y,e as S,W as g,i as w}from"./BP8Zqz1I.js";const v="$s";function f(...r){const l=typeof r[r.length-1]=="string"?r.pop():void 0;typeof r[0]!="string"&&r.unshift(l);const[o,n]=r;if(!o||typeof o!="string")throw new TypeError("[nuxt] [useState] key must be a string: "+o);if(n!==void 0&&typeof n!="function")throw new Error("[nuxt] [useState] init must be a function: "+n);const u=v+o,m=h(),a=d(m.payload.state,u);if(a.value===void 0&&n){const s=n();if(y(s))return m.payload.state[u]=s,s;a.value=s}return a}const p="ceramic_user_v1";function N(){const r=f("auth-user",()=>null),l=f("auth-initialized",()=>!1);if(!l.value)try{const t=localStorage.getItem(p);if(t){const e=JSON.parse(t);e&&typeof e.id=="number"&&e.phoneNumber&&(r.value={id:Number(e.id),username:String(e.username||""),phoneNumber:String(e.phoneNumber||""),email:String(e.email||""),address:String(e.address||""),pincode:String(e.pincode||"")})}}catch{}finally{l.value=!0}const o=S(()=>!!r.value?.id),n=w(),u=String(n.public.apiBase||"").replace(/\/$/,""),m=async t=>{if(!t||!t.trim())throw new Error("Phone number is required");try{const e=`${u}/user/login?phoneNumber=${encodeURIComponent(t.trim())}`,i=await $fetch(e,{method:"POST",headers:{accept:"*/*"}});if(i&&i.id){r.value=i;try{localStorage.setItem(p,JSON.stringify(i))}catch{}return i}return null}catch(e){if(e?.statusCode===404||e?.status===404)return null;throw e}},a=async t=>{if(!t.phoneNumber||!t.phoneNumber.trim())throw new Error("Phone number is required");if(!t.username||!t.username.trim())throw new Error("Username is required");if(!t.email||!t.email.trim())throw new Error("Email is required");try{const e=new URLSearchParams({id:"0",username:t.username.trim(),phoneNumber:t.phoneNumber.trim(),email:t.email.trim(),address:(t.address||"").trim(),pincode:(t.pincode||"").trim()}),i=`${u}/user/create?${e.toString()}`,c=await $fetch(i,{method:"POST",headers:{accept:"*/*"}});if(c&&c.id){r.value=c;try{localStorage.setItem(p,JSON.stringify(c))}catch{}return c}throw new Error("Failed to create user")}catch(e){throw e}},s=()=>{r.value=null;try{localStorage.removeItem(p)}catch{}};return{user:g(r),isAuthenticated:o,login:m,signup:a,logout:s}}export{f as a,N as u};
