import{_ as et}from"./CRWhLXmG.js";import{u as st,_ as at}from"./B9bVLpYc.js";import{_ as rt}from"./B8m7qWkO.js";import{_ as ot,u as nt,e as U,f as it,c as u,a as s,b as y,w as k,g as o,t as l,h as R,F as lt,r as ct,T as ut,i as dt,j as g,o as d,d as H}from"./BP8Zqz1I.js";import{u as mt}from"./9Frihcan.js";import{u as pt}from"./EIUoMLvZ.js";const gt={class:"cart-page"},vt={class:"topbar"},yt={class:"topbar-actions"},ft={key:0,class:"cart-badge","aria-label":"Cart items"},ht={class:"content"},_t={key:0,class:"loading"},bt={key:1,class:"error"},wt={class:"error-sub"},Ct={key:2,class:"empty-cart"},It={key:3,class:"cart-content"},kt={class:"cart-items"},$t=["src","alt"],St={key:0,class:"discount-badge"},qt={class:"item-details"},Pt={class:"item-qty-badge"},xt={class:"item-row"},Ft={class:"quantity-controls"},Ut=["disabled","onClick"],Rt={class:"qty-value"},Tt=["disabled","onClick"],Nt={class:"item-price"},Mt=["disabled","onClick"],Bt={class:"order-summary"},Lt={class:"summary-row"},At={class:"summary-value"},Ot={key:0,class:"summary-row discount-row"},Qt={class:"summary-value discount-value"},Vt={class:"summary-row total-row"},Dt={class:"summary-value total-value"},Ht=["disabled"],Wt={key:0,class:"toast"},Yt={__name:"cart",setup(jt){const c=mt(),$=nt(),W=dt(),f=String(W.public.apiBase||"").replace(/\/$/,""),b=st(),T=g(!1);c.isAuthenticated.value||$.push("/login?redirect="+encodeURIComponent("/cart"));const w=g(null),N=g(!1),S=g(null),q=g(""),i=g(new Set),C=g(!1),P=g("");let M=null;const h=async()=>{if(!c.isAuthenticated.value||!c.user.value){S.value=!0,q.value="Please log in to view your cart";return}const e=c.user.value;N.value=!0,S.value=null,q.value="";try{const t=new URLSearchParams({id:String(e.id),username:e.username||"",phoneNumber:e.phoneNumber||"",email:e.email||"",address:e.address||"",pincode:e.pincode||""}),a=`${f}/user/load/cart?${t.toString()}`,n=await $fetch(a,{method:"POST",headers:{accept:"*/*"}});w.value=n,j(n)}catch(t){console.error("[Cart] Failed to load cart:",t),S.value=t,q.value=t?.message||"Failed to load cart. Please try again."}finally{N.value=!1}},I=U(()=>{if(!w.value?.cart||!w.value?.ceremics)return[];const e=w.value.cart,t=w.value.ceremics;return e.map(a=>{const n=t.find(v=>v.id===a.productId);return n?{cartId:a.id,productId:a.productId,quantity:a.quantity,product:n}:null}).filter(Boolean)}),O=U(()=>I.value.reduce((e,t)=>e+t.product.price*t.quantity,0)),B=U(()=>I.value.reduce((e,t)=>{if(!L(t.product))return e;const a=t.product.discounts.discount||0,n=t.product.price*t.quantity;return e+n*a/100},0)),Y=U(()=>O.value-B.value),Q=e=>String(e||"").toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,""),j=e=>{if(!e?.cart||!e?.ceremics){b.items.value=[];return}const t=e.cart,a=e.ceremics,n=t.map(v=>{const r=a.find(F=>F.id===v.productId);if(!r||v.quantity<=0)return null;let p="";if(r.images&&r.images.length>0){const F=r.images.find(tt=>tt.catalogImage);F?.imageUrl?p=_(F.imageUrl):r.images[0]?.imageUrl&&(p=_(r.images[0].imageUrl))}!p&&r.image?.value&&(p=_(r.image.value));const Z=Q(r.name);return{id:r.id,name:r.name||"Ceramic Product",price:Number(r.price||0),qty:v.quantity,image:p||void 0,slug:`/product/${Z}-${r.id}`}}).filter(Boolean);b.items.value=n},V=e=>`/product/${Q(e.name)}-${e.id}`,x=e=>{const t=Number(e||0);return new Intl.NumberFormat("en-IN",{maximumFractionDigits:0}).format(t)},L=e=>e?.discounts?.enable&&e?.discounts?.discount>0,z=e=>{if(!L(e))return e.price;const t=e.discounts.discount||0;return Math.round(e.price*(100-t)/100)},D=e=>{const t=String(e||"").trim();return t?!!t.includes("img.icons8.com"):!1},_=e=>{const t=String(e||"").trim();if(!t||D(t))return"";if(t.includes("localhost:9090")||t.includes("localhost:"))try{const a=new URL(t),n=a.pathname+a.search;return`${f}${n}`}catch{const a=t.match(/localhost:\d+(\/.*)/);return a?`${f}${a[1]}`:t}return t.startsWith("http://")||t.startsWith("https://")?t:t.startsWith("/")?`${f}${t}`:t},E=e=>{if(e.images&&e.images.length>0){const a=e.images.find(n=>n.catalogImage);if(a?.imageUrl)return _(a.imageUrl);if(e.images[0]?.imageUrl)return _(e.images[0].imageUrl)}if(e.image?.value)return D(e.image.value)?"/images/ceramic-plate.svg":_(e.image.value);const t=e.productDetails?.find(a=>a.dimension?.name==="Type")?.value?.toLowerCase()||"plate";return t.includes("mug")?"/images/ceramic-mug.svg":t.includes("bowl")?"/images/ceramic-bowl.svg":t.includes("vase")?"/images/ceramic-vase.svg":"/images/ceramic-plate.svg"},A=async(e,t)=>{if(!c.isAuthenticated.value||!c.user.value?.id)return!1;try{const a=new URLSearchParams({id:"0",userId:String(c.user.value.id),productId:String(e),quantity:String(Math.max(0,t))}),n=`${f}/user/cart?${a.toString()}`;return await $fetch(n,{method:"POST",headers:{accept:"*/*"}}),!0}catch(a){return console.warn("Failed to sync cart item:",a),!1}},G=async e=>{if(!i.value.has(e.cartId)){i.value.add(e.cartId);try{const t=e.quantity+1;await A(e.productId,t)?await h():m("Failed to update quantity. Please try again.")}finally{i.value.delete(e.cartId)}}},J=async e=>{if(!(i.value.has(e.cartId)||e.quantity<=1)){i.value.add(e.cartId);try{const t=e.quantity-1;await A(e.productId,t)?await h():m("Failed to update quantity. Please try again.")}finally{i.value.delete(e.cartId)}}},K=async e=>{if(!i.value.has(e.cartId)){i.value.add(e.cartId);try{await A(e.productId,0)?(await h(),m("Item removed from cart")):m("Failed to remove item. Please try again.")}finally{i.value.delete(e.cartId)}}},X=async()=>{if(!c.isAuthenticated.value||!c.user.value){m("Please log in to checkout"),$.push("/login?redirect="+encodeURIComponent("/cart"));return}if(I.value.length===0){m("Your cart is empty");return}if(C.value)return;C.value=!0;const e=c.user.value;try{const t=new URLSearchParams({id:String(e.id),username:e.username||"",phoneNumber:e.phoneNumber||"",email:e.email||"",address:e.address||"",pincode:e.pincode||""}),a=`${f}/user/order?${t.toString()}`;await $fetch(a,{method:"POST",headers:{accept:"*/*"}}),console.log("[Cart] Order placed successfully"),await b.clear(),await h(),$.push("/purchased")}catch(t){console.error("[Cart] Failed to place order:",t);const a=t?.statusCode||t?.status||t?.response?.status;a>=400&&a<500?m("Failed to place order. Please check your information and try again."):a>=500?m("Server error. Please try again later."):m("Failed to place order. Please check your connection and try again.")}finally{C.value=!1}},m=e=>{P.value=e,M&&clearTimeout(M),M=setTimeout(()=>{P.value=""},3e3)};return it(()=>{c.isAuthenticated.value&&h()}),pt({title:"Shopping Cart - Ceramic Artistry",meta:[{name:"robots",content:"noindex, nofollow"}]}),(e,t)=>{const a=et,n=at,v=rt;return d(),u("div",gt,[t[18]||(t[18]=s("div",{class:"top-banner"},[s("p",{class:"banner-text"},"Designed to impress, Made to use")],-1)),s("header",vt,[s("button",{class:"menu-btn",type:"button","aria-label":"Menu",onClick:t[0]||(t[0]=r=>T.value=!0)},[...t[3]||(t[3]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M3 12h18M3 6h18M3 18h18"})],-1)])]),y(a,{to:"/",class:"brand-logo"},{default:k(()=>[...t[4]||(t[4]=[s("span",{class:"logo-text"},"SVRVE",-1),s("span",{class:"logo-dot"},"â€¢",-1)])]),_:1}),s("div",yt,[s("button",{class:"cart-btn",type:"button",onClick:t[1]||(t[1]=r=>o($).push("/cart")),"aria-label":"Cart"},[t[5]||(t[5]=s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"}),s("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),s("path",{d:"M16 10a4 4 0 0 1-8 0"})],-1)),o(b).totalQty.value?(d(),u("span",ft,l(o(b).totalQty.value),1)):R("",!0)]),y(n)])]),y(v,{"is-open":o(T),onClose:t[2]||(t[2]=r=>T.value=!1)},null,8,["is-open"]),s("div",ht,[o(N)?(d(),u("section",_t,[...t[6]||(t[6]=[s("div",{class:"loading-spinner"},null,-1),s("p",{class:"loading-text"},"Loading your cart...",-1)])])):o(S)?(d(),u("section",bt,[t[7]||(t[7]=s("h1",{class:"error-title"},"Couldn't load cart",-1)),s("p",wt,l(o(q)),1),s("button",{class:"retry",type:"button",onClick:h},"Retry")])):o(I).length?(d(),u("section",It,[s("div",kt,[(d(!0),u(lt,null,ct(o(I),r=>(d(),u("div",{key:r.cartId,class:"cart-item"},[y(a,{to:V(r.product),class:"item-image"},{default:k(()=>[s("img",{src:E(r.product),alt:r.product.name,loading:"lazy"},null,8,$t),L(r.product)?(d(),u("span",St,l(r.product.discounts.discount)+"% OFF ",1)):R("",!0)]),_:2},1032,["to"]),s("div",qt,[y(a,{to:V(r.product),class:"item-name"},{default:k(()=>[H(l(r.product.name),1)]),_:2},1032,["to"]),s("div",Pt,"QTY: "+l(r.quantity),1),s("div",xt,[s("div",Ft,[s("button",{type:"button",class:"qty-btn",disabled:o(i).has(r.cartId)||r.quantity<=1,onClick:p=>J(r)}," âˆ’ ",8,Ut),s("span",Rt,l(r.quantity),1),s("button",{type:"button",class:"qty-btn",disabled:o(i).has(r.cartId),onClick:p=>G(r)}," + ",8,Tt)]),s("div",Nt,"Rs. "+l(x(z(r.product))),1)]),s("button",{type:"button",class:"remove-btn",disabled:o(i).has(r.cartId),onClick:p=>K(r)},[...t[12]||(t[12]=[s("span",{class:"remove-icon"},"ðŸ—‘ï¸",-1),s("span",null,"Remove",-1)])],8,Mt)])]))),128))]),s("div",Bt,[t[16]||(t[16]=s("h2",{class:"summary-title"},"Order Summary",-1)),s("div",Lt,[t[13]||(t[13]=s("span",{class:"summary-label"},"Subtotal",-1)),s("span",At,"Rs. "+l(x(o(O))),1)]),o(B)>0?(d(),u("div",Ot,[t[14]||(t[14]=s("span",{class:"summary-label"},"Discount",-1)),s("span",Qt,"-Rs. "+l(x(o(B))),1)])):R("",!0),t[17]||(t[17]=s("div",{class:"summary-divider"},null,-1)),s("div",Vt,[t[15]||(t[15]=s("span",{class:"summary-label"},"Total",-1)),s("span",Dt,"Rs. "+l(x(o(Y))),1)]),s("button",{type:"button",class:"checkout-btn",disabled:o(C),onClick:X},l(o(C)?"Processing...":"Proceed to Checkout"),9,Ht)])])):(d(),u("section",Ct,[t[9]||(t[9]=s("div",{class:"empty-icon"},"ðŸ›’",-1)),t[10]||(t[10]=s("h2",{class:"empty-title"},"Your cart is empty",-1)),t[11]||(t[11]=s("p",{class:"empty-sub"},"Add some beautiful ceramics to get started!",-1)),y(a,{to:"/collections",class:"browse-btn"},{default:k(()=>[...t[8]||(t[8]=[H("Browse Collections",-1)])]),_:1})]))]),y(ut,{name:"toast"},{default:k(()=>[o(P)?(d(),u("div",Wt,l(o(P)),1)):R("",!0)]),_:1})])}}},Zt=ot(Yt,[["__scopeId","data-v-ac6aaf9b"]]);export{Zt as default};
